<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PlaySum</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <!-- Bootstrap CSS for layout and styling -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
  <!-- FontAwesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    /* Global Styling */
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }
    body.light-mode {
      background-color: #f8f9fa;
      color: #333;
    }
    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      background: #1db954;
      color: #fff;
    }
    .header h2 {
      margin: 0;
      font-weight: 600;
    }
    .header button {
      border: 1px solid #fff;
    }
    /* Layout */
    .playlist {
      max-height: 90vh;
      overflow-y: auto;
      border-right: 1px solid rgba(0,0,0,0.1);
      padding: 15px;
    }
    .playlist-item {
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: background 0.2s;
    }
    .playlist-item:hover {
      background: rgba(255,255,255,0.1);
    }
    .playlist-item.active {
      background: rgba(255,255,255,0.2);
    }
    /* Player Panel */
    .player-panel {
      padding: 20px;
      text-align: center;
    }
    .cover {
      width: 300px;
      height: 300px;
      background-size: cover;
      background-position: center;
      margin: 0 auto;
      border-radius: 10px;
      position: relative;
    }
    /* Loading Spinner Overlay */
    .spinner-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 300px;
      height: 300px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.5);
      border-radius: 10px;
      display: none;
    }
    .player-info {
      margin-top: 20px;
    }
    .player-info h3 {
      margin-bottom: 5px;
    }
    .player-info p {
      margin-top: 0;
      opacity: 0.8;
    }
    /* Player Controls */
    .player-controls {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .player-controls button {
      background: none;
      border: none;
      color: inherit;
      font-size: 30px;
      margin: 0 20px;
      cursor: pointer;
      outline: none;
    }
    /* Progress Bar */
    .progress-container {
      width: 80%;
      margin: 20px auto;
      cursor: pointer;
      position: relative;
      height: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 5px;
    }
    .progress {
      height: 100%;
      width: 0;
      background: #1db954;
      border-radius: 5px;
    }
    /* Favorite Button */
    #favoriteBtn {
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 22px;
      margin-top: 15px;
      border: none;
      background: transparent;
      color: inherit;
      outline: none;
    }
  </style>
</head>
<body class="dark-mode">
  <!-- Header -->
  <div class="header">
    <h2>PlaySum - Made by Anubhav</h2>
    <div>
      <button id="toggleMode" class="btn btn-outline-light">Light Mode</button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container-fluid">
    <div class="row no-gutters">
      <!-- Playlist Column -->
      <div class="col-md-3 playlist" id="playlist">
        <!-- Playlist items will be injected here -->
      </div>
      <!-- Player Column -->
      <div class="col-md-9">
        <div class="player-panel">
          <div class="cover" id="cover">
            <div class="spinner-overlay" id="spinner">
              <div class="spinner-border text-light" role="status">
                <span class="sr-only">Loading...</span>
              </div>
            </div>
          </div>
          <div class="player-info">
            <h3 id="trackName">Track Name</h3>
            <p id="artistName">Artist Name</p>
            <button id="favoriteBtn"><i class="far fa-heart"></i></button>
          </div>
          <!-- Progress Bar -->
          <div class="progress-container" id="progressContainer">
            <div class="progress" id="progress"></div>
          </div>
          <!-- Player Controls -->
          <div class="player-controls">
            <button id="prev" title="Previous"><i class="fas fa-step-backward"></i></button>
            <button id="play" title="Play/Pause"><i class="fas fa-play"></i></button>
            <button id="next" title="Next"><i class="fas fa-step-forward"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery library -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <!-- Bootstrap JS bundle -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <!-- Howler.js for audio playback -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  <script>
    /* --- Track Data --- */
    const tracks = [
      {
        trackName: 'Oh Okay',
        artist: 'Gunna',
        src: 'song1.mp3',
        cover: 'https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fimage%2F2024%2F04%2F15%2Fgunna-one-of-wun-album-announcement-cover-art-0.jpg?w=960&cbr=1&q=90&fit=max',
        isFavorite: false
      },
      {
        trackName: 'Dumb, Dumber and Dumber',
        artist: 'Lil Baby',
        src: 'song2.mp3',
        cover: 'https://www.nme.com/wp-content/uploads/2021/01/nme-big-read-2021-lil-baby-cover@1990x2488.jpg',
        isFavorite: false
      },
      {
        trackName: 'Hold Me Up',
        artist: 'Young Thug',
        src: 'song3.mp3',
        cover: 'https://static.wikia.nocookie.net/totalwar-ar/images/a/ac/Young_Thug.jpg/revision/latest/scale-to-width-down/450?cb=20210611170218',
        isFavorite: false
      }
    ];

    let currentTrackIndex = 0;
    let isPlaying = false;
    let sound; // Howler.js sound instance

    /* --- Favorites Persistence --- */
    function loadFavorites() {
      const favs = JSON.parse(localStorage.getItem('favoriteTracks')) || {};
      tracks.forEach((track, index) => {
        track.isFavorite = !!favs[index];
      });
    }
    function saveFavorites() {
      const favs = {};
      tracks.forEach((track, index) => {
        if (track.isFavorite) {
          favs[index] = true;
        }
      });
      localStorage.setItem('favoriteTracks', JSON.stringify(favs));
    }

    /* --- Load Track --- */
    function loadTrack(index) {
      if (sound) {
        sound.unload();
      }
      const track = tracks[index];
      // Show spinner and disable play button until loaded
      $('#spinner').show();
      $('#play').prop('disabled', true);
      
      sound = new Howl({
        src: [track.src],
        html5: true,
        onload: function() {
          $('#spinner').hide();
          $('#play').prop('disabled', false);
          updateProgress();
        },
        onloaderror: function() {
          alert('Error loading track');
          $('#spinner').hide();
        },
        onplay: function() {
          updateProgress();
        },
        onend: function() {
          nextTrack();
        }
      });
      // Update UI details
      $('#cover').css('background-image', `url('${track.cover}')`);
      $('#trackName').text(track.trackName);
      $('#artistName').text(track.artist);
      updateFavoriteButton(track.isFavorite);
      highlightActiveTrack();
    }

    /* --- Update Favorite Button --- */
    function updateFavoriteButton(isFavorite) {
      if (isFavorite) {
        $('#favoriteBtn').html('<i class="fas fa-heart"></i>');
      } else {
        $('#favoriteBtn').html('<i class="far fa-heart"></i>');
      }
    }

    /* --- Playback Controls --- */
    function togglePlay() {
      if (!sound) return;
      if (isPlaying) {
        sound.pause();
        isPlaying = false;
        $('#play').html('<i class="fas fa-play"></i>');
      } else {
        sound.play();
        isPlaying = true;
        $('#play').html('<i class="fas fa-pause"></i>');
      }
    }
    function prevTrack() {
      currentTrackIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
      loadTrack(currentTrackIndex);
      sound.play();
      isPlaying = true;
      $('#play').html('<i class="fas fa-pause"></i>');
    }
    function nextTrack() {
      currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
      loadTrack(currentTrackIndex);
      sound.play();
      isPlaying = true;
      $('#play').html('<i class="fas fa-pause"></i>');
    }

    /* --- Progress Bar --- */
    function updateProgress() {
      if (sound && sound.playing()) {
        const seek = sound.seek() || 0;
        const duration = sound.duration() || 1;
        const progressPercent = (seek / duration) * 100;
        $('#progress').css('width', progressPercent + '%');
      }
      if (isPlaying) {
        requestAnimationFrame(updateProgress);
      }
    }
    // Allow click-to-seek
    $('#progressContainer').click(function(e) {
      if (!sound) return;
      const posX = e.offsetX;
      const totalWidth = $(this).width();
      const duration = sound.duration();
      const seekTime = (posX / totalWidth) * duration;
      sound.seek(seekTime);
      updateProgress();
    });
    // Enable dragging on the progress bar
    let isSeeking = false;
    $('#progressContainer').on('mousedown', function(e) {
      isSeeking = true;
      const posX = e.offsetX;
      const totalWidth = $(this).width();
      const duration = sound.duration();
      const seekTime = (posX / totalWidth) * duration;
      sound.seek(seekTime);
      updateProgress();
    });
    $(document).on('mousemove', function(e) {
      if (isSeeking && sound) {
        const offset = $('#progressContainer').offset();
        const posX = e.pageX - offset.left;
        const totalWidth = $('#progressContainer').width();
        const duration = sound.duration();
        const seekTime = (posX / totalWidth) * duration;
        sound.seek(seekTime);
        updateProgress();
      }
    });
    $(document).on('mouseup', function() {
      if (isSeeking) {
        isSeeking = false;
      }
    });

    /* --- Playlist UI --- */
    function populatePlaylist() {
      $('#playlist').empty();
      tracks.forEach((track, index) => {
        const favoriteIcon = track.isFavorite
          ? '<i class="fas fa-heart text-danger"></i>'
          : '<i class="far fa-heart"></i>';
        const item = $(`
          <div class="playlist-item" data-index="${index}">
            <div>
              <strong>${track.trackName}</strong><br>
              <small>${track.artist}</small>
            </div>
            <div>${favoriteIcon}</div>
          </div>
        `);
        item.click(function() {
          currentTrackIndex = index;
          loadTrack(currentTrackIndex);
          sound.play();
          isPlaying = true;
          $('#play').html('<i class="fas fa-pause"></i>');
        });
        $('#playlist').append(item);
      });
    }
    function highlightActiveTrack() {
      $('.playlist-item').removeClass('active');
      $(`.playlist-item[data-index="${currentTrackIndex}"]`).addClass('active');
    }

    /* --- Favorite Toggle --- */
    $('#favoriteBtn').click(function() {
      tracks[currentTrackIndex].isFavorite = !tracks[currentTrackIndex].isFavorite;
      updateFavoriteButton(tracks[currentTrackIndex].isFavorite);
      populatePlaylist();
      saveFavorites();
    });

    /* --- Control Event Listeners --- */
    $('#play').click(togglePlay);
    $('#prev').click(prevTrack);
    $('#next').click(nextTrack);
    $('#toggleMode').click(function() {
      if ($('body').hasClass('dark-mode')) {
        $('body').removeClass('dark-mode').addClass('light-mode');
        $(this).text('Dark Mode');
      } else {
        $('body').removeClass('light-mode').addClass('dark-mode');
        $(this).text('Light Mode');
      }
    });

    /* --- Initialization --- */
    $(document).ready(function() {
      loadFavorites();
      populatePlaylist();
      loadTrack(currentTrackIndex);
    });
  </script>
</body>
</html>
